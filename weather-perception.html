// Fetch weather data from OpenWeatherMap
function fetchWeather(cityName, state) {
    const url = `https://api.openweathermap.org/data/2.5/forecast?q=${cityName}&appid=${apiKey}&units=imperial`;
    console.log(`Fetching 5-day weather for ${cityName}, ${state}...`);
    
    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error fetching data for ${cityName}: ${response.statusText}`);
            }
            return response.json();
        })
        .then(data => {
            const forecastDiv = document.getElementById('forecast');
            forecastDiv.innerHTML = `<h2>5-Day Weather Forecast for ${cityName}, ${state}</h2>`;
            
            let dayCount = 0;
            let today = new Date().getDate();

            data.list.forEach((forecast) => {
                const forecastDate = new Date(forecast.dt * 1000);

                if (forecastDate.getDate() !== today) {
                    dayCount++;
                    today = forecastDate.getDate();

                    const temp = forecast.main.temp;
                    const perception = classifyTemperature(state, temp);
                    const iconCode = forecast.weather[0].icon;
                    const iconUrl = `https://openweathermap.org/img/wn/${iconCode}.png`;

                    forecastDiv.innerHTML += `
                        <div class="forecast-entry">
                            <img class="weather-icon" src="${iconUrl}" alt="Weather icon" />
                            <p>${forecastDate.toLocaleDateString()}: ${temp}Â°F - Perceived as ${perception}</p>
                        </div>
                    `;
                }
            });
        })
        .catch(error => {
            console.error(error);
            const forecastDiv = document.getElementById('forecast');
            forecastDiv.innerHTML = `<p style="color:red;">Failed to fetch data for ${cityName}, ${state}: ${error.message}</p>`;
        });
}
